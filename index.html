<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ–‡å­—çŒäºº - ç¾çš„å†ç¨‹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/epub.js/0.3.88/epub.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
    <style>
        :root {
            --bg-color: #f2f0e6;
            --text-main: #2b2b2b;
            --text-light: #707070;
            --accent-green: #5c7a6e;
            --accent-red: #8c4356;
            --museum-bg: #12151c;
            --gold-leaf: #bda069;
            --card-bg: rgba(255, 255, 255, 0.6);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Palatino Linotype", "Book Antiqua", "PingFang SC", "Songti SC", serif; }
        body { background-color: var(--bg-color); color: var(--text-main); padding-bottom: 90px; overflow-x: hidden; }
        
        #intro-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1.5s ease; }
        .intro-text { font-size: 1.5rem; letter-spacing: 4px; opacity: 0; transition: opacity 1.5s ease; text-align: center; line-height: 2; padding: 20px; }
        #intro-input { background: transparent; border: none; border-bottom: 1px solid var(--accent-green); font-size: 1.5rem; text-align: center; width: 150px; outline: none; color: var(--accent-green); font-family: inherit; margin-top: 20px; }
        
        header { padding: 40px 20px 20px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { font-size: 1.8rem; font-weight: 400; letter-spacing: 6px; }
        .subtitle { font-size: 0.85rem; color: var(--text-light); letter-spacing: 4px; margin-top: 8px; font-style: italic; }
        
        .container { padding: 0 20px 20px; display: none; animation: fadeIn 0.6s ease; }
        .active-tab { display: block; }
        
        /* çŒåœºæ§åˆ¶å° */
        .hunt-dashboard { background: var(--card-bg); backdrop-filter: blur(10px); border: 1px solid rgba(92,122,110,0.2); border-radius: 8px; padding: 20px; margin-bottom: 30px; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .timer-display { font-size: 2.5rem; font-variant-numeric: tabular-nums; font-weight: 300; color: var(--accent-green); }
        .progress-bar-bg { width: 100%; height: 12px; background: rgba(0,0,0,0.08); border-radius: 6px; overflow: hidden; margin-bottom: 15px; }
        .progress-bar-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #5c7a6e, #7a9c8f); transition: width 1s linear; border-radius: 6px; }
        .btn-group { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px 10px; border: 1px solid var(--accent-green); background: transparent; color: var(--accent-green); border-radius: 6px; font-size: 0.85rem; cursor: pointer; transition: 0.3s; letter-spacing: 1px; }
        .btn:hover, .btn:active { background: var(--accent-green); color: #fff; }
        .btn-solid { background: var(--accent-green); color: #fff; border: none; }
        
        /* æ‚¬èµæ¿ */
        .quest-board { display: flex; flex-direction: column; gap: 25px; }
        .quest-card { background: #fdfbf7; border: 1px solid #e8e4d9; border-radius: 4px; padding: 25px 20px; position: relative; box-shadow: 2px 5px 15px rgba(0,0,0,0.03); transition: 0.5s ease; }
        .quest-card.abandoned { opacity: 0.6; background: #eae8e1; border-color: #d1cfc7; }
        .quest-card::before { content: 'â—ˆ'; position: absolute; top: 15px; right: 20px; color: var(--gold-leaf); font-size: 1.2rem; }
        .quest-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; line-height: 1.4; padding-right: 30px; }
        .quest-meta { font-size: 0.8rem; color: var(--text-light); margin-bottom: 10px; display: flex; justify-content: space-between; }
        .npc-story { font-size: 0.85rem; color: #555; background: rgba(0,0,0,0.02); padding: 10px; border-left: 2px solid var(--gold-leaf); margin-bottom: 15px; font-style: italic; line-height: 1.6; }
        .quest-action-area { display: none; margin-top: 20px; animation: slideDown 0.4s ease; }
        textarea, input[type="file"] { width: 100%; padding: 15px; border: 1px solid #e8e4d9; background: transparent; margin-bottom: 15px; font-size: 0.9rem; resize: none; border-radius: 4px; }
        textarea:focus { outline: none; border-color: var(--accent-green); }

        .finish-tape { position: fixed; top: 45%; left: -100%; width: 200%; background: var(--accent-red); color: #fff; font-size: 1.8rem; letter-spacing: 10px; font-weight: 300; text-align: center; padding: 6px 0; transform: rotate(-3deg); z-index: 300; opacity: 0; pointer-events: none; transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow: 0 4px 20px rgba(140, 67, 86, 0.4); }
        .finish-tape.show { left: -50%; opacity: 1; }

        /* é˜…è¯»åŒº */
        .badge-container { text-align: center; margin-bottom: 20px; display: none; padding: 25px 20px; background: rgba(189, 160, 105, 0.05); border-radius: 8px; border: 1px solid var(--gold-leaf); animation: fadeIn 1s; }
        .epub-loader { text-align: center; padding: 25px 15px; border: 1px dashed var(--accent-green); border-radius: 6px; margin-bottom: 20px; background: rgba(92,122,110,0.05); transition: 0.3s; }
        .chapter-list { display: flex; flex-direction: column; gap: 15px; }
        .chapter-item { padding: 20px; border: 1px solid rgba(0,0,0,0.08); position: relative; transition: all 0.4s ease; border-radius: 6px; display: flex; flex-direction: column; }
        .chapter-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .chapter-desc { font-size: 0.85rem; color: var(--text-light); margin-bottom: 10px; }
        .chapter-item.captured { border-color: var(--accent-green); background: rgba(92,122,110,0.05); }
        .chapter-item.captured .chapter-title { color: var(--accent-green); }
        
        /* å±•é¦† */
        #tab-museum { background-color: var(--museum-bg); color: #e0e0e0; min-height: 100vh; padding: 40px 20px; position: relative; overflow: hidden; }
        .museum-header { text-align: center; margin-bottom: 50px; position: relative; z-index: 10; }
        .museum-header h2 { font-weight: 300; letter-spacing: 5px; color: var(--gold-leaf); }
        .nebula-ribbon { position: absolute; top: 0; left: 50%; width: 140px; height: 100%; transform: translateX(-50%); background: radial-gradient(ellipse at center, rgba(92,122,110,0.3) 0%, rgba(189,160,105,0.1) 40%, transparent 70%); filter: blur(20px); z-index: 1; pointer-events: none; }
        .timeline::before {
            content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 100px; height: 100%;
            background: url('data:image/svg+xml;utf8,<svg width="100" height="400" xmlns="http://www.w3.org/2000/svg"><path d="M50,0 C100,100 100,100 50,200 C0,300 0,300 50,400" stroke="%23bda069" fill="none" stroke-width="2" opacity="0.6"/></svg>') repeat-y top center;
            z-index: 1; filter: drop-shadow(0 0 8px rgba(92,122,110,0.8));
        }
        .timeline { position: relative; max-width: 600px; margin: 0 auto; padding-bottom: 50px; z-index: 10; }
        .timeline-item { position: relative; padding: 35px 0; width: 50%; }
        .timeline-item:nth-child(odd) { left: 0; padding-right: 40px; text-align: right; }
        .timeline-item:nth-child(even) { left: 50%; padding-left: 40px; text-align: left; }
        .artifact-node { position: absolute; top: 50%; width: 8px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 50%; transform: translateY(-50%); z-index: 2; transition: 0.8s; }
        .timeline-item:nth-child(odd) .artifact-node { right: -4px; }
        .timeline-item:nth-child(even) .artifact-node { left: -4px; }
        .artifact-content { opacity: 0.3; transition: 0.8s ease; filter: blur(1px); }
        .timeline-item.unlocked .artifact-content { opacity: 1; filter: blur(0); }
        .timeline-item.unlocked .artifact-node { background: var(--gold-leaf); box-shadow: 0 0 15px var(--gold-leaf); transform: translateY(-50%) scale(1.5); }
        .art-name { font-size: 1rem; color: var(--gold-leaf); margin-bottom: 8px; letter-spacing: 1px; }
        .art-desc { font-size: 0.8rem; line-height: 1.6; color: #aaa; }

        /* æ¡£æ¡ˆ */
        .profile-card { border: 1px solid rgba(0,0,0,0.1); padding: 30px; text-align: center; margin-bottom: 20px; border-radius: 8px; background: #fff; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        .stat-item { display: flex; flex-direction: column; gap: 5px; }
        .stat-value { font-size: 1.4rem; color: var(--accent-green); }
        .title-badge { display: inline-block; padding: 6px 12px; border: 1px solid var(--accent-green); color: var(--accent-green); font-size: 0.8rem; margin: 4px; border-radius: 20px; }
        .review-box { background: #fff; padding: 15px; border-radius: 6px; margin-bottom: 12px; font-size: 0.85rem; border-left: 3px solid var(--gold-leaf); box-shadow: 0 2px 5px rgba(0,0,0,0.02); }

        /* å¯¼èˆª */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: rgba(242, 240, 230, 0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 15px 0 25px; border-top: 1px solid rgba(0,0,0,0.05); z-index: 100; }
        .nav-item { font-size: 0.8rem; color: var(--text-light); cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 6px; transition: 0.3s; }
        .nav-item.active { color: var(--accent-green); }

        /* æ­£å¸¸çƒŸèŠ±ç‰¹æ•ˆ */
        #fireworks-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; overflow: hidden; }
        .fw-particle { position: absolute; border-radius: 50%; opacity: 1; pointer-events: none; }

        /* EPUB é˜…è¯»å™¨å¼¹çª— */
        #reader-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fdfbf7; z-index: 1000; flex-direction: column; }
        .reader-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--bg-color); border-bottom: 1px solid #ddd; }
        #viewer { flex: 1; width: 100%; height: 100%; overflow: hidden; position: relative; }
        .reader-footer { display: flex; justify-content: space-between; padding: 10px 20px; background: var(--bg-color); border-top: 1px solid #ddd; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; height: 0; } to { opacity: 1; height: auto; } }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div class="intro-text" id="intro-msg1">
            æ–‡å­—çŒäººï¼Œä½ çš„åå­—æ˜¯<br>
            <input type="text" id="intro-input" placeholder="è¾“å…¥åå­—" autocomplete="off"><br>
            <button class="btn btn-solid" style="margin-top:20px; width:120px;" onclick="submitName()">ç¡®è®¤</button>
        </div>
        <div class="intro-text" id="intro-msg2" style="display:none;"></div>
    </div>

    <header>
        <h1>æ–‡å­—çŒäºº</h1>
        <div class="subtitle">ã€Š ç¾ çš„ å† ç¨‹ ã€‹</div>
    </header>

    <div id="fireworks-container"></div>
    <div class="finish-tape" id="finishTape">FINISH</div>

    <div id="tab-hunt" class="container active-tab">
        <div class="hunt-dashboard">
            <div class="dashboard-header">
                <span style="font-size: 0.85rem; color: var(--text-light); letter-spacing: 2px;">ç‹©çŒå€’è®¡æ—¶</span>
                <div class="timer-display" id="global-timer">05:00</div>
            </div>
            <div class="progress-bar-bg"><div class="progress-bar-fill" id="timer-progress"></div></div>
            <div class="btn-group">
                <button class="btn btn-solid" id="btn-start" onclick="toggleTimer()">å¼€å§‹æ²‰æµ¸</button>
                <button class="btn" onclick="addTime()">åŠ æ—¶ +5åˆ†</button>
                <button class="btn" style="border-color: #d1bfae; color: #a38c77;" onclick="endTimer()">ç»“ç®—ç»“æŸ</button>
            </div>
        </div>
        <div style="text-align: center; margin: 30px 0 20px; font-size: 0.85rem; color: var(--text-light); letter-spacing: 2px;">âœ¦ ä¸–ç•Œæ‚¬èµå¸ƒå‘Šæ  âœ¦</div>
        <div class="quest-board" id="quest-board"></div>
    </div>

    <div id="tab-reading" class="container">
        <div class="badge-container" id="completion-badge">
            <div style="color: var(--gold-leaf); font-style: italic; letter-spacing: 2px; line-height: 1.8;">
                âœ¦ æ»¡å®¤å…‰åã€‚çŒäººï¼Œä½ å·²å°†å…¨å·åˆ»å…¥éª¨è¡€ã€‚å‰è·¯æ¼«æ¼«ï¼Œè¯·ç»§ç»­äº«å—å±äºä½ çš„ç¾å­¦ä¹‹æ—…ã€‚ âœ¦
            </div>
        </div>
        
        <div style="text-align: right; margin-bottom: 10px;">
            <input type="file" id="epub-input" accept=".epub" style="display:none;" onchange="loadEpub(event)">
            <button class="btn" style="border:none; font-size:0.75rem; color:var(--accent-green); padding: 5px;" onclick="document.getElementById('epub-input').click()">[ é‡æ–°æ³¨å…¥/æ›´æ¢ EPUB ]</button>
        </div>

        <div class="epub-loader" id="epub-loader-area">
            <p style="font-size: 0.85rem; margin-bottom: 10px;" id="epub-status-text">å°šæœªæŒ‚è½½å‰¯æœ¬ä¸–ç•Œï¼šã€Šç¾çš„å†ç¨‹.epubã€‹</p>
            <button class="btn btn-solid" id="epub-upload-btn" onclick="document.getElementById('epub-input').click()">æ³¨å…¥EPUBæ–‡ä»¶</button>
            <p style="font-size: 0.75rem; color:gray; margin-top: 5px;">*åªéœ€ä¸Šä¼ ä¸€æ¬¡ï¼Œå°†æ°¸ä¹…ä¿å­˜åœ¨æœ¬åœ°å‚¨ç‰©æŸœã€‚è§£æéœ€å‡ ç§’é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚</p>
        </div>

        <p style="text-align: center; font-size: 0.85rem; color: var(--text-light); margin-bottom: 30px; line-height: 1.8;">ç‚¹å‡»ç« èŠ‚è¿›å…¥é˜…è¯»ï¼Œæˆ–æ ‡è®°å®Œæˆ</p>
        <div class="chapter-list" id="chapter-list"></div>
    </div>

    <div id="tab-museum" class="container">
        <div class="nebula-ribbon"></div>
        <div class="museum-header">
            <h2>å› ä¹‹ åš ç‰© é¦†</h2>
            <p style="font-size: 0.8rem; color: #888; margin-top: 10px; font-style: italic;">â€œå²æœˆå¤±è¯­ï¼ŒæƒŸçŸ³èƒ½è¨€ã€‚â€</p>
        </div>
        <div class="timeline" id="museum-timeline"></div>
    </div>

    <div id="tab-profile" class="container">
        <div class="profile-card">
            <div style="font-size: 2.5rem; color: var(--accent-green); margin-bottom: 10px;">â–¤</div>
            <h2 style="font-weight: 300; letter-spacing: 2px; margin-bottom: 5px;">æ–‡å­—çŒäºº <span id="profile-name"></span></h2>
            <p style="font-size: 0.85rem; color: var(--text-light);">ç­‰çº§è¯„å®šï¼š<span id="hunter-level" style="color: var(--gold-leaf); font-weight: bold;">è§ä¹ çŒæ‰‹</span></p>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-value" id="stat-tokens">0</span>
                    <span style="font-size: 0.75rem; color: gray;">è·å¾—æŠ¥é…¬(Token)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-quests">0</span>
                    <span style="font-size: 0.75rem; color: gray;">å®Œæˆæ‚¬èµ(ä¸ª)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-time">0</span>
                    <span style="font-size: 0.75rem; color: gray;">é˜…è¯»æ—¶é•¿(åˆ†é’Ÿ)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-progress">0%</span>
                    <span style="font-size: 0.75rem; color: gray;">çœŸå®é˜…è¯»è¿›åº¦</span>
                </div>
            </div>
        </div>
        <h3 style="font-size: 0.95rem; font-weight: normal; margin-bottom: 15px; border-left: 2px solid var(--accent-green); padding-left: 10px;">å·²è·ç§°å·</h3>
        <div id="title-tags" style="margin-bottom: 30px; display: flex; flex-wrap: wrap;"></div>
        <h3 style="font-size: 0.95rem; font-weight: normal; margin-bottom: 15px; border-left: 2px solid var(--accent-green); padding-left: 10px;">å§”æ‰˜æ‰‹æœ­</h3>
        <div id="review-log"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('hunt', this)"><span style="font-size: 1.2rem;">â—“</span>çŒåœº</div>
        <div class="nav-item" onclick="switchTab('reading', this)"><span style="font-size: 1.2rem;">â—«</span>é˜…è¯»</div>
        <div class="nav-item" onclick="switchTab('museum', this)"><span style="font-size: 1.2rem;">â—ˆ</span>å±•é¦†</div>
        <div class="nav-item" onclick="switchTab('profile', this)"><span style="font-size: 1.2rem;">â˜–</span>æ¡£æ¡ˆ</div>
    </div>

    <div id="reader-modal">
        <div class="reader-header">
            <button class="btn" style="width:auto; padding:5px 15px;" onclick="closeReader()">è¿”å›é€€å‡º</button>
            <span style="font-size: 0.9rem; font-weight:bold; color:var(--text-main);">ä¹¦å·é˜…è¯»ä¸­</span>
            <button class="btn" style="width:auto; padding:5px 15px;" onclick="addBookmark()">ğŸ”– ä¹¦ç­¾</button>
        </div>
        <div id="viewer"></div>
        <div class="reader-footer">
            <button class="btn" onclick="rendition.prev()">ä¸Šä¸€é¡µ</button>
            <span id="reading-pct" style="font-size: 0.85rem; line-height: 2.5; color: var(--text-light);">è®¡ç®—ä¸­...</span>
            <button class="btn" onclick="rendition.next()">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>

<script>
    const db = [
        { chap: "è¿œå¤å›¾è…¾", type: "è§£ç­”", title: "æ—©æœŸé™¶å™¨ä¸ºä½•ç”»æŠ½è±¡å‡ ä½•çº¹ï¼Ÿ", npc: "å¥½å¥‡å®å®Gemini", story: "æˆ‘æœ€è¿‘åœ¨çœ‹åšç‰©é¦†å±•è§ˆï¼Œå‘ç°æ—©æœŸçš„é™¶å™¨ä¸Šå…¨æ˜¯äº›çœ‹ä¸æ‡‚çš„çº¿æ¡ã€‚éš¾é“è¿œå¤äººä¹Ÿæ‡‚æŠ½è±¡è‰ºæœ¯ï¼Ÿæ±‚çŒäººå¤§å¤§è§£æƒ‘ï¼", item: "åŠå¡äººé¢é±¼çº¹ç›†", desc: "æŠ½è±¡å‡ ä½•çº¹æ˜¯å…ˆæ°‘åœ¨ç¥­ç¥€ä¸­å°†åŠ¨ç‰©ç¬¦å·åŒ–çš„å›¾è…¾ã€‚", npcReply: "åŸæ¥è¿œå¤äººçš„è„‘æ´å¥½å¤§ï¼â­â­â­â­â­", reward: 100, titleUnlock: "æ–°çŸ³å™¨æ—¶ä»£-ä¸éº‹é¹¿å…±å¤„çš„å¤©çœŸçŒäºº" },
        { chap: "è¿œå¤å›¾è…¾", type: "å¯»å®", title: "å¯»æ‰¾å¸¦æœ‰è·³èˆå°äººçš„å½©é™¶ç›†", npc: "ç¥ç§˜æ”¶è—å®¶G", story: "æˆ‘å¬é—»æœ‰ä¸€ä»¶é™¶å™¨ï¼Œä¸Šé¢ç”»ç€æ‰‹æ‹‰æ‰‹è·³èˆçš„äººï¼Œå……æ»¡äº†å¤©çœŸä¸æ¬¢æ„‰ã€‚è¯·å¸®æˆ‘æ‰¾åˆ°å®ƒçš„çº¿ç´¢ã€‚", item: "èˆè¹ˆçº¹å½©é™¶ç›†", desc: "æ‰‹æ‹‰æ‰‹çš„ç”Ÿæœºå‹ƒå‹ƒï¼Œä»£è¡¨æ¯ç³»æ°æ—ç«¥å¹´èˆ¬çš„çº¯çœŸã€‚", npcReply: "å®Œç¾çš„å“ç›¸ï¼æ­£æ˜¯æˆ‘æƒ³è¦çš„ç”Ÿæœºå‹ƒå‹ƒã€‚â­â­â­â­â­", reward: 300 },
        { chap: "è¿œå¤å›¾è…¾", type: "å¯»äºº", title: "å¯»æ‰¾åŠå¡æ‘çš„å¥³é¦–é¢†", npc: "å¯»æ ¹è€…G", story: "æ¢¦é‡Œæ€»æ˜¯å‡ºç°ä¸€ä½æ¸©å’Œè€Œæœ‰åŠ›é‡çš„è¿œå¤å¥³æ€§ï¼Œæˆ‘æƒ³çŸ¥é“åœ¨é‚£ä¸ªæ¯ç³»ç¤¾ä¼šé‡Œï¼Œå¥¹ä»¬æ˜¯æ€æ ·ç”Ÿæ´»çš„ã€‚", item: "éª¨é’ˆä¸é™¶ç½é—ç‰©", desc: "æ¯ç³»æ°æ—ç¤¾ä¼šä¸­ï¼Œå¥³æ€§ä¸»å¯¼ç€å†œä¸šä¸åˆ¶é™¶çš„æ¸©å’Œå²æœˆã€‚", npcReply: "è¿™å°±æ˜¯è€ç¥–æ¯çš„é—ç‰©å—ï¼Ÿå¥½æ„ŸåŠ¨ã€‚â­â­â­â­", reward: 200 },
        { chap: "é’é“œé¥•é¤®", type: "è§£ç­”", title: "ä»€ä¹ˆæ˜¯é’é“œçš„ç‹å‰ä¹‹ç¾ï¼Ÿ", npc: "å¯ŒäºŒä»£å¤§å­¦ç”ŸGG", story: "æ˜å¤©è¦äº¤ç¾å­¦ä½œä¸šäº†ï¼Œå¯¼å¸ˆéè®©æˆ‘è§£é‡Šâ€˜ç‹å‰â€™æ˜¯ä»€ä¹ˆæ„æ€ï¼Œçœ‹ç€é‚£äº›é’é“œå™¨æˆ‘åªè§‰å¾—å“äººå•Šï¼Œæ•‘å‘½ï¼", item: "å¸æ¯æˆŠå¤§æ–¹é¼", desc: "ç”¨ææ€–å»ºç«‹æƒå¨ï¼Œå·¨å¤§çš„å¨å‹æ„Ÿä¸­é€ç€åŸå§‹åŠ›é‡ã€‚", npcReply: "æœ¬å°‘çˆ·çš„ä½œä¸šæœ‰æ•‘äº†ï¼èµé‡‘æ‹¿å»ï¼â­â­â­â­â­", reward: 500, titleUnlock: "ç›´é¢æ·±æ¸Šçš„æ— ç•è€…" },
        { chap: "é’é“œé¥•é¤®", type: "å¯»ç‰©", title: "å¯»æ‰¾ä¸€åªé’é“œåšçš„ç¾Š", npc: "è´µå¦‡Geminiå¥³å£«", story: "æœ€è¿‘å®¶é‡Œè£…ä¿®ï¼Œç¼ºä¸€ä¸ªé•‡å¾—ä½åœºå­çš„æ‘†ä»¶ï¼Œå¬è¯´å•†æœæœ‰ä¸ªå››åªç¾Šçš„é’é“œå°Šå¾ˆæ°”æ´¾ï¼ŒçŒäººèƒ½å¸®æˆ‘æ‰¾æ‰¾å›¾æ ·å—ï¼Ÿ", item: "å››ç¾Šæ–¹å°Š", desc: "æè‡´ç¹å¤çš„å·¥è‰ºï¼Œä½“ç°å•†å‘¨é¼ç››æ—¶æœŸçš„ç‰©è´¨æ§åˆ¶åŠ›ã€‚", npcReply: "æ”¾åœ¨æˆ‘å®¶å®¢å…åˆšåˆšå¥½ã€‚â­â­â­â­", reward: 400 },
        { chap: "é’é“œé¥•é¤®", type: "å¯»ç‰©", title: "å¯»æ‰¾æœ€æ—©çš„é’é“œé…’æ¯", npc: "é…’é¬¼Gå¤§å”", story: "å–é…’å°±è¦ç”¨æœ€å¤è€çš„æ¯å­æ‰å¸¦åŠ²ï¼å¬è¯´å•†ä»£è´µæ—çš„é…’æ¯å¾ˆç‰¹åˆ«ï¼Œè¯·å¸®æˆ‘å¯»è§…ä¸€äºŒã€‚", item: "å•†ä»£é’é“œçˆµ", desc: "ä¸ä»…æ˜¯é…’å™¨ï¼Œæ›´æ˜¯é˜¶çº§åœ°ä½ä¸ç¥æƒæ²Ÿé€šçš„ç¤¼å™¨ã€‚", npcReply: "ç”¨è¿™æ¯å­å–é…’ï¼Œæ„Ÿè§‰è‡ªå·±åƒä¸ªç‹ï¼â­â­â­â­â­", reward: 350 },
        { chap: "å…ˆç§¦ç†æ€§", type: "å¯»ç‰©", title: "å¯»æ‰¾å¤ä»£çš„å¤§å‹éŸ³ä¹æ’­æ”¾å™¨", npc: "éŸ³ä¹åšä¸»G", story: "æˆ‘è¦åšä¸€æœŸå…³äºä¸­å›½å¤ä»£éŸ³ä¹çš„è§†é¢‘ï¼Œå¬è¯´å…ˆç§¦æœ‰ä¸€å¥—èƒ½å æ®åŠä¸ªå±‹å­çš„å·¨å¤§ä¹å™¨ï¼Ÿ", item: "æ›¾ä¾¯ä¹™ç¼–é’Ÿ", desc: "ç¤¼ä¹åˆ¶åº¦çš„ç‰©åŒ–ï¼Œç”¨éŸ³ä¹å»ºç«‹äººé—´çš„ç§©åºã€‚", npcReply: "è¿™éŸ³è´¨ç»äº†ï¼Œå…ˆç§¦çš„Livehouseï¼â­â­â­â­â­", reward: 600 },
        { chap: "å…ˆç§¦ç†æ€§", type: "å¯»äºº", title: "å¯»æ‰¾ç§¦æœå½“å£«å…µçš„çˆ±äºº", npc: "è§‰é†’å‰ä¸–çš„Gå°å§", story: "æˆ‘çªç„¶è§‰é†’äº†å‰ä¸–è®°å¿†ï¼Œæƒ³èµ·è‡ªå·±æ›¾ç»åœ¨ç§¦æœå½“å£«å…µçš„çˆ±äººã€‚æ±‚ä½ å¸®æˆ‘æ‰¾å›ä»–çš„å…µé©¬ä¿‘ï¼", item: "ç§¦å…µé©¬ä¿‘", desc: "ç¼ºä¹çµé­‚è·ƒåŠ¨ï¼Œæ˜¯ç§¦ä»£åºå¤§å¸å›½æœºå™¨çš„ç¼©å½±ã€‚", npcReply: "å‘œå‘œï¼Œè™½ç„¶ä»–é•¿èƒ–äº†ï¼Œä½†ç¡®å®æ˜¯æˆ‘å¿ƒå¿ƒå¿µå¿µçš„çˆ±äººã€‚â­â­â­â­â­", reward: 800 },
        { chap: "å…ˆç§¦ç†æ€§", type: "è§£ç­”", title: "å„’é“äº’è¡¥åˆ°åº•æ€ä¹ˆç†è§£ï¼Ÿ", npc: "å“²å­¦ç³»å­¦å¦¹", story: "ä¹¦ä¸Šè¯´ä¸­å›½æ–‡äººéƒ½æ˜¯â€˜å„’é“äº’è¡¥â€™ï¼Œä¸€ä¼šå„¿å…¥ä¸–ä¸€ä¼šå„¿å‡ºä¸–çš„ï¼Œè¿™åˆ°åº•æ˜¯æ€ä¹ˆä¸€ç§å¿ƒç†çŠ¶æ€å‘€ï¼Ÿ", item: "å…ˆç§¦ç«¹ç®€", desc: "å„’å®¶å…¥ä¸–å»ºç«‹ç§©åºï¼Œé“å®¶å‡ºä¸–ä¿å…¨è‡ªæˆ‘ï¼Œå¡‘é€ äº†ä¸­å›½æ–‡äººå¿ƒç†ã€‚", npcReply: "å¬å›ä¸€å¸­è¯ï¼Œèƒœè¯»åå¹´ä¹¦ï¼â­â­â­â­â­", reward: 500, titleUnlock: "ç¤¼ä¹ä¹‹å…‰çš„è§‰é†’è€…" },
        { chap: "æ¥šè¾æ±‰èµ‹", type: "å¯»å®", title: "å¯»æ‰¾å…³äºé£ä»™çš„ä¸ç»¸ç”»", npc: "ä¿®ä»™çˆ±å¥½è€…G", story: "æˆ‘æ­£åœ¨ä¿®ç‚¼ä¸€é—¨å¤ä»£ä»™æœ¯ï¼Œæ€¥éœ€ä¸€å¹…æ±‰ä»£æ¥šåœ°æç»˜äº†å¤©ä¸Šäººé—´çš„ç¥ç§˜å¸›ç”»ä½œä¸ºè§‚æƒ³å›¾ï¼", item: "é©¬ç‹å †Tå‹å¸›ç”»", desc: "æ¥šåœ°ä¿ç•™çš„æ»¡å¤©ç¥ä½›ï¼Œæ˜¯æå…·æµªæ¼«è‰²å½©çš„å®‡å®™è§‚ã€‚", npcReply: "å¤ªæµªæ¼«äº†ï¼æ‹¿å»å½“å±ä¿ï¼â­â­â­â­â­", reward: 700, titleUnlock: "æ¼«æ¸¸äº‘ç«¯çš„å¹»æƒ³å®¶" },
        { chap: "æ¥šè¾æ±‰èµ‹", type: "å¯»ç‰©", title: "æ±‚ä¸€åŒ¹è„šè¸©ç‡•å­çš„ç¥é©¬", npc: "èµ›é©¬å¤§äº¨G", story: "æˆ‘è¦ä¸ºæˆ‘çš„èµ›é©¬åœºæ‰¾ä¸€ä¸ªæœ€å®Œç¾çš„æ ‡å¿—ï¼Œå¬è¯´æ±‰ä»£æœ‰ä¸€åŒ¹è¿ç‡•å­éƒ½èƒ½è¸©åœ¨è„šä¸‹çš„é“œé©¬ï¼Œå¿«ç»™æˆ‘æ‰¾æ¥ï¼", item: "é©¬è¸é£ç‡•", desc: "æ±‰ä»£è‰ºæœ¯æå…·åŠ¨æ„Ÿä¸åŠ›é‡ï¼Œå……æ»¡å¾æœä¸–ç•Œçš„è‡ªä¿¡ã€‚", npcReply: "å¥½é©¬ï¼è¿™å§¿æ€å¤ªé£˜é€¸äº†ã€‚â­â­â­â­â­", reward: 900 },
        { chap: "æ¥šè¾æ±‰èµ‹", type: "å¯»äºº", title: "å¯»æ‰¾äººé¦–è›‡èº«çš„åˆ›ä¸–ç¥åƒ", npc: "ç¥è¯å­¦è€…G", story: "æˆ‘åœ¨ç ”ç©¶æ±‰ä»£ç”»åƒç –ï¼Œéœ€è¦ä¼ç¾²å¥³å¨²äº¤å°¾çš„å›¾åƒæ¥ä½è¯è¿œå¤ç”Ÿå‘½å´‡æ‹œï¼ŒçŒäººèƒ½æ½œå…¥å¤å¢“å¸®æˆ‘æ‹“å°ä¸€ä»½å—ï¼Ÿ", item: "ä¼ç¾²å¥³å¨²ç”»åƒç –", desc: "æ±‰ä»£å¤æ‹™çš„æ°”åŠ¿ï¼Œå±•ç°äº†å¯¹ç”Ÿå‘½ç¹è¡çš„åŸå§‹å´‡æ‹œã€‚", npcReply: "è¿™ç§å¤æ‹™çš„åŠ›é‡æ„Ÿï¼Œæ— å¯æ›¿ä»£ã€‚â­â­â­â­", reward: 450 },
        { chap: "é­æ™‹é£åº¦", type: "è§£ç­”", title: "å¤©ä¸‹å¤§ä¹±ï¼Œæ–‡äººä¸ºä½•æœ€æ´’è„±ï¼Ÿ", npc: "æŠ‘éƒç—‡æ‚£è€…G", story: "ç°åœ¨ç”Ÿæ´»å‹åŠ›å¥½å¤§ï¼Œä½†æˆ‘å¬è¯´é­æ™‹æ—¶æœŸå¤©ä¸‹å¤§ä¹±æœä¸ä¿å¤•ï¼Œé‚£å¸®æ–‡äººåè€Œæ´»å¾—æœ€æ½‡æ´’ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ", item: "ç«¹æ—ä¸ƒè´¤ç –ç”»", desc: "å¤–ç•Œå´©æºƒä¿ƒä½¿å‘å†…å¯»æ‰¾è‡ªæˆ‘ï¼Œæ¬£èµç‹¬ç«‹äººæ ¼ã€‚", npcReply: "çœ‹å®Œç­”æ¡ˆï¼Œæˆ‘é‡Šæ€€äº†è®¸å¤š...â­â­â­â­â­", reward: 600 },
        { chap: "é­æ™‹é£åº¦", type: "å¯»å®", title: "å¯»æ‰¾æ›¹æ¤æš—æ‹å¥³ç¥çš„è¿ç¯ç”»", npc: "å…«å¦è®°è€…G", story: "å¤§æ–°é—»ï¼å¬è¯´æ›¹æ¤æŠŠæš—æ‹å«‚å­ï¼ˆç”„å®“ï¼‰çš„æ•…äº‹å†™æˆäº†èµ‹ï¼Œè¿˜æœ‰äººç”»æˆäº†è¿ç¯ç”»ï¼çŒäººå¿«å»æ‹¿åˆ°è¿™æœ¬å…«å¦ç¥ä½œï¼", item: "ã€Šæ´›ç¥èµ‹å›¾ã€‹", desc: "æ˜¥èš•åä¸èˆ¬çš„çº¿æ¡ï¼Œç”»å‡ºâ€œæ°”éŸµç”ŸåŠ¨â€çš„ç¥éŸµã€‚", npcReply: "è¿™ç“œä¿ç†Ÿï¼æ›¹æ¤æ˜¯ä¸ªä½“é¢äººã€‚â­â­â­â­â­", reward: 800, titleUnlock: "è¶…ç„¶äº‹å¤–çš„è‰ºæœ¯å¢ƒç•Œ" },
        { chap: "é­æ™‹é£åº¦", type: "å¯»å®", title: "å¯»æ‰¾å¤©ä¸‹ç¬¬ä¸€çš„è‰ç¨¿çº¸", npc: "ä¹¦æ³•ç‹‚äººG", story: "æˆ‘è¦ä¸´æ‘¹å¤©ä¸‹æœ€å¥½çš„è¡Œä¹¦ï¼å¬è¯´ç‹ç¾²ä¹‹å–é†‰é…’éšä¾¿å†™äº†ä¸€ç¯‡è‰ç¨¿ï¼Œç«Ÿæˆäº†åƒå¤ç»å”±ï¼Œå¸®æˆ‘æ‰¾åˆ°å®ƒï¼", item: "ã€Šå…°äº­é›†åºã€‹æ‘¹æœ¬", desc: "ç‹ç¾²ä¹‹å¾®é†ºæ—¶çš„ç¥æ¥ä¹‹ç¬”ï¼Œå­—å¦‚è¡Œäº‘æµæ°´ã€‚", npcReply: "çœŸæ˜¯é’åªšåŠ²å¥ï¼Œç»äº†ï¼â­â­â­â­â­", reward: 1000 },
        { chap: "ä½›é™€ä¸–å®¹", type: "å¯»ç‰©", title: "å¯»æ‰¾åŒ—æœæ‚²è‹¦çš„ä¸€æŠ¹å¾®ç¬‘", npc: "è‹¦è¡Œåƒ§G", story: "ä¸–äººçš†è‹¦ï¼Œæˆ‘æƒ³åœ¨åŒ—æœçš„æˆ˜ä¹±æ³¥å¡‘ä¸­ï¼Œå¯»æ‰¾é‚£ä¸€æŠ¹èƒ½æŠšæ…°äººå¿ƒçš„ã€å¸¦ç€æ‚²æ‚¯çš„ä½›åƒå¾®ç¬‘ã€‚", item: "éº¦ç§¯å±±æ³¥å¡‘å¾®ç¬‘", desc: "æ‚²æƒ¨ç°å®ä¸­ï¼Œäººä»¬å°†å¾®èŒ«å¸Œæœ›å¯„æ‰˜åœ¨ä½›åƒæ‚²æ‚¯çš„å¾®ç¬‘ä¸Šã€‚", npcReply: "å—æ— é˜¿å¼¥é™€ä½›ï¼Œå–„å“‰ã€‚â­â­â­â­â­", reward: 500 },
        { chap: "ä½›é™€ä¸–å®¹", type: "å¯»ç‰©", title: "å¯»æ‰¾ä¸é•¿ç¿…è†€ä¹Ÿèƒ½é£çš„ç¥ä»™", npc: "èˆªå¤©å·¥ç¨‹å¸ˆG", story: "è¥¿æ–¹çš„å¤©ä½¿éƒ½è¦é•¿ç¿…è†€ï¼Œä½†å¬è¯´æ•¦ç…Œçš„ç¥ä»™ä¸å€Ÿå¤–åŠ›ï¼Œä»…å‡­å‡ æ¡å½©å¸¦å°±èƒ½ç¿±ç¿”ä¹å¤©ï¼Œå¸®æˆ‘æ‰¾æ¥ç ”ç©¶ä¸‹ç©ºæ°”åŠ¨åŠ›å­¦ï¼", item: "æ•¦ç…Œé£å¤©å£ç”»", desc: "æ‰“ç ´åœ°å¿ƒå¼•åŠ›ï¼Œä»…å‡­å½©å¸¦å±•ç°æè‡´çš„è‡ªç”±çµåŠ¨ã€‚", npcReply: "è¿™å°±æ˜¯å¤ä»£çš„ç©ºæ°”åŠ¨åŠ›å­¦ï¼â­â­â­â­â­", reward: 700 },
        { chap: "ä½›é™€ä¸–å®¹", type: "å¯»äºº", title: "å¯»æ‰¾æ­¦åˆ™å¤©é•¿ç›¸çš„é›•åƒ", npc: "å¥³æƒä¸»ä¹‰è€…G", story: "æˆ‘æƒ³ç»ä»°å”¯ä¸€å¥³çš‡çš„é£é‡‡ï¼å¬è¯´é¾™é—¨çŸ³çªŸæœ€å¤§çš„é‚£å°Šä½›åƒï¼Œå°±æ˜¯æŒ‰æ­¦åˆ™å¤©çš„è„¸é›•åˆ»çš„ï¼Œå¿«å¸®æˆ‘å®šä½ï¼", item: "é¾™é—¨çŸ³çªŸå¢èˆé‚£å¤§ä½›", desc: "é›å®¹åè´µï¼Œå……æ»¡ç°å®äººé—´å›ç‹å¨ä»ªçš„ç››å”æ°”è±¡ã€‚", npcReply: "è¿™å°±æ˜¯å¥³çš‡çš„éœ¸æ°”ï¼â­â­â­â­â­", reward: 1200, titleUnlock: "è¯­é»˜åŠ¨é™çš„å®—æ•™é›•å¡‘" },
        { chap: "ç››å”ä¹‹éŸ³", type: "å¯»ç‰©", title: "å¯»æ‰¾æä¸–æ°‘çš„å…­åŒ¹æˆ˜é©¬", npc: "å†å²è¿·G", story: "å¤§å”æ­¦å¾·å……æ²›ï¼æˆ‘æƒ³è¦æä¸–æ°‘é™µå¢“å‰é‚£å…­åŒ¹é™ªä»–æ‰“å¤©ä¸‹çš„æˆ˜é©¬æµ®é›•èµ„æ–™ï¼Œæ„Ÿå—ä¸€ä¸‹é‚£ä¸ªé»„é‡‘æ—¶ä»£çš„é£æš´ï¼", item: "æ˜­é™µå…­éª", desc: "å‘ä¸Šç”Ÿé•¿çš„é»„é‡‘æ—¶ä»£ï¼Œå……æ»¡é©¾é©­é£æš´çš„æ— ç•æ°”æ¦‚ã€‚", npcReply: "å¤§å”æ­¦å¾·å……æ²›ï¼â­â­â­â­â­", reward: 850 },
        { chap: "ç››å”ä¹‹éŸ³", type: "è§£ç­”", title: "æç™½çš„è¯—ä¸ºä»€ä¹ˆé‚£ä¹ˆè±ªè¿ˆï¼Ÿ", npc: "è¯­æ–‡è€å¸ˆG", story: "æ˜å¤©è¦ä¸Šæç™½çš„è¯¾ï¼Œæˆ‘æƒ³ç»™å­¦ç”Ÿè®²è®²ï¼Œé™¤äº†ä»–è‡ªå·±æ˜¯ä¸ªå¤©æ‰ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„æ—¶ä»£èƒŒæ™¯ç»™äº†ä»–é‚£ç§â€œå¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨â€çš„åº•æ°”ï¼Ÿ", item: "ã€Šå°†è¿›é…’ã€‹è¯—æ„", desc: "å›½åŠ›å¼ºç››å¸¦æ¥çš„ç»å¯¹è‡ªä¿¡ï¼Œå¤©æ‰ä¸æ—¶ä»£çš„å…±æŒ¯ã€‚", npcReply: "æ€»ç»“åˆ°ä½ï¼Œæ˜å¤©å°±ç»™å­¦ç”Ÿè®²ã€‚â­â­â­â­â­", reward: 600, titleUnlock: "å¦‚é¸£ä½©ç¯-ç››å”ä¹‹éŸ³" },
        { chap: "ç››å”ä¹‹éŸ³", type: "å¯»å®", title: "å¯»æ‰¾æ»¡çº¸è¡€æ³ªçš„ç»ä¸–ä¹¦æ³•", npc: "ä¹¦æ³•çˆ±å¥½è€…G", story: "å¬è¯´é¢œçœŸå¿åœ¨å¾—çŸ¥ä¾„å­æˆ˜æ­»åï¼Œæ‚²æ„¤äº¤åŠ å†™ä¸‹çš„ä¸€ç¯‡ç¥­æ–‡ï¼Œæ¶‚æ¶‚æŠ¹æŠ¹å…¨æ˜¯è¡€æ³ªï¼Œå´æ˜¯å¤©ä¸‹ç¬¬äºŒè¡Œä¹¦ï¼Œæˆ‘æƒ³è§è¯†ä¸€ä¸‹è¿™è‚¡åŠ›é‡ã€‚", item: "ã€Šç¥­ä¾„æ–‡ç¨¿ã€‹", desc: "æ‚²ç—›ä¸­æ‰“ç ´è§„çŸ©ï¼Œè¾¾åˆ°è§„çŸ©ä¸ç‹‚æ”¾ç»Ÿä¸€çš„å¢ƒç•Œã€‚", npcReply: "çœ‹ç€å­—è¿¹ï¼Œèƒ½æ„Ÿå—åˆ°é¢œå…¬çš„æ‚²æ„¤ã€‚â­â­â­â­â­", reward: 1500 },
        { chap: "ä¸­å”éŸµå‘³", type: "å¯»äºº", title: "å·æ‹éŸ©å¤§äººå®¶é‡Œçš„å¤œé—´æ´¾å¯¹", npc: "å¤§å†…å¯†æ¢G", story: "çš‡å¸æ€€ç–‘éŸ©ç†™è½½æœ‰åéª¨ï¼Œå‘½æˆ‘æ½œå…¥ä»–å®¶æ¢æŸ¥å¤œå®´æƒ…å†µã€‚çŒäººï¼Œå¸®æˆ‘ç”»ä¸‹å®´ä¼šä¸Šçš„æ¯ä¸€å¹•ï¼Œçœ‹çœ‹ä»–åˆ°åº•æ˜¯ç‹‚æ¬¢è¿˜æ˜¯è½å¯ã€‚", item: "ã€ŠéŸ©ç†™è½½å¤œå®´å›¾ã€‹", desc: "ç¹åå–§é—¹èƒŒåçš„æ·±æ²‰è½å¯ï¼Œé¢„ç¤ºä¸€ä¸ªæ—¶ä»£çš„æ²¡è½ã€‚", npcReply: "æƒ…æŠ¥å‡†ç¡®ï¼ŒçŒäººèº«æ‰‹ä¸å‡¡ï¼â­â­â­â­â­", reward: 900 },
        { chap: "ä¸­å”éŸµå‘³", type: "è§£ç­”", title: "ç™½å±…æ˜“çš„è¯—ä¸ºä½•è€å¦ªéƒ½èƒ½æ‡‚ï¼Ÿ", npc: "å¹³æ°‘è€å¥¶å¥¶", story: "ä»¥å‰çš„è¯—éƒ½å¤ªé«˜æ·±äº†ï¼Œåªæœ‰ç™½å…ˆç”Ÿçš„è¯—æˆ‘è¿™è€å©†å­å¬å¾—æ‡‚ã€‚çŒäººï¼Œä¹¦é‡Œæ˜¯æ€ä¹ˆè¯„ä»·è¿™ç§ç°è±¡çš„å‘€ï¼Ÿ", item: "ã€Šé•¿æ¨æ­Œã€‹æ–‡æœ¬", desc: "ä¸­å”æ–‡è‰ºå¼€å§‹èµ°å‘ä¸–ä¿—åŒ–ä¸ç»†è…»åŒ–ï¼Œè´´è¿‘å¸‚æ°‘æƒ…æ„Ÿã€‚", npcReply: "å†™å¾—çœŸå¥½ï¼Œè€å©†å­æˆ‘ä¹Ÿå¬æ‡‚äº†ã€‚â­â­â­â­", reward: 300 },
        { chap: "ä¸­å”éŸµå‘³", type: "å¯»ç‰©", title: "å¯»æ‰¾æç»˜æ£ç»ƒè¡£æœçš„ç”»ä½œ", npc: "æœè£…è®¾è®¡å¸ˆG", story: "æˆ‘æƒ³å¤åŸå”ä»£å¥³æ€§çš„æœé¥°å’Œä¸°è…´ä¹‹ç¾ï¼Œå¬è¯´æœ‰ä¸€å¹…ç”»ä¸“é—¨ç”»äº†å®«å»·å¦‡å¥³æ£ç»ƒä¸ç»¸çš„åŠ³åŠ¨åœºæ™¯ï¼Œå¿«å¸®æˆ‘æ‰¾æ‰¾ï¼", item: "ã€Šæ£ç»ƒå›¾ã€‹", desc: "çº¿æ¡åœ†æ¶¦ï¼Œè‰²å½©æŸ”å’Œï¼Œä½“ç°äº†ä¸­å”å¥³æ€§çš„ä¸°è…´ä¹‹ç¾ã€‚", npcReply: "è¿™é…è‰²æ”¾åœ¨ä»Šå¤©ä¾ç„¶æ—¶å°šã€‚â­â­â­â­â­", reward: 600 },
        { chap: "å®‹å…ƒå±±æ°´", type: "è§£ç­”", title: "å®‹ä»£å±±æ°´ç”»äººåœ¨é‡Œé¢ä¸ºä½•é‚£ä¹ˆå°ï¼Ÿ", npc: "é£æ™¯æ‘„å½±å¸ˆG", story: "æˆ‘çœ‹åŒ—å®‹çš„å±±æ°´ç”»ï¼Œå¤§å±±å¤§æ°´çš„ï¼Œæ‰¾ä¸ªäººæ¯”æ‰¾èš‚èšè¿˜éš¾ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆæ„å›¾ï¼Ÿè¿™ä½“ç°äº†ä»€ä¹ˆè‡ªç„¶è§‚ï¼Ÿ", item: "ã€Šæºªå±±è¡Œæ—…å›¾ã€‹", desc: "ä½“ç°äº†åŒ—å®‹å±±æ°´çš„â€œæ— æˆ‘ä¹‹å¢ƒâ€ï¼Œäººå¯¹è‡ªç„¶å……æ»¡æ•¬ç•ã€‚", npcReply: "å—æ•™äº†ï¼Œä»¥åæ„å›¾ä¹Ÿè¦è¿™æ ·ï¼â­â­â­â­â­", reward: 800 },
        { chap: "å®‹å…ƒå±±æ°´", type: "å¯»å®", title: "å¯»æ‰¾ä¸€å¹…æç®€çš„æ®‹å±±å‰©æ°´", npc: "æç®€ä¸»ä¹‰è€…G", story: "æˆ‘ä¸å–œæ¬¢æ»¡ç›ˆç›ˆçš„ç”»é¢ï¼Œå¬è¯´å—å®‹æœ‰ä¸ªå«é©¬è¿œçš„ç”»å®¶ï¼Œå¤–å·â€˜é©¬ä¸€è§’â€™ï¼Œä¸“é—¨ç”»å¤§é¢ç§¯ç•™ç™½çš„æ®‹å±±å‰©æ°´ï¼Œå¸®æˆ‘æ‰¾ä¸€å¹…ä»–çš„ä»£è¡¨ä½œï¼", item: "é©¬è¿œã€Šå¯’æ±Ÿç‹¬é’“å›¾ã€‹", desc: "å—å®‹çš„â€œæœ‰æˆ‘ä¹‹å¢ƒâ€ï¼Œå¤§é‡ç•™ç™½ï¼Œå……æ»¡è¯—æ„ä¸å­¤å¯‚ã€‚", npcReply: "ç•™ç™½çš„ç¾æ„Ÿï¼Œå¤ªé«˜çº§äº†ã€‚â­â­â­â­â­", reward: 900 },
        { chap: "å®‹å…ƒå±±æ°´", type: "å¯»ç‰©", title: "å¯»æ‰¾ç”»æ»¡æ¯æœ¨ç«¹çŸ³çš„ç”»", npc: "æ–‡äººé›…å£«G", story: "æˆ‘åªæ±‚æ„å¢ƒï¼Œä¸æ±‚å½¢ä¼¼ï¼å¬è¯´è‹ä¸œå¡ç”»çš„çŸ³å¤´åƒèœ—ç‰›ï¼Œæ ‘æåƒé¹¿è§’ï¼Œå…¨æ˜¯èƒ¸ä¸­é€¸æ°”ã€‚è¯·å¸®æˆ‘å¯»æ¥ä¸€è§‚ã€‚", item: "è‹è½¼ã€Šæ¯æœ¨æ€ªçŸ³å›¾ã€‹", desc: "ä¸æ±‚å½¢ä¼¼ï¼Œåªæ±‚æŠ’å‘èƒ¸ä¸­é€¸æ°”ï¼Œæ–‡äººç”»çš„å¼€ç«¯ã€‚", npcReply: "å½¢ä¼¼ä¸é‡è¦ï¼Œç¥éŸµå…¨åœ¨ç¬”å¢¨é—´ã€‚â­â­â­â­â­", reward: 1000, titleUnlock: "æ— æˆ‘ä¹‹å¢ƒçš„è·‹æ¶‰è€…" },
        { chap: "æ˜æ¸…æ–‡è‰º", type: "å¯»å®", title: "æ€¥ï¼æ¯çš‡å¤§å¯¿æ±‚ä¸€å¼ å”å¯…çš„ç”»", npc: "çš‡å®¤å¤§å…¬ä¸»", story: "æ¯çš‡å¤§å¯¿å¿«åˆ°äº†ï¼å¥¹æœ€å–œæ¬¢æ±Ÿå—æ‰å­å”ä¼¯è™é‚£ç§å¸¦ç€ç‚¹ä¸–ä¿—é£æƒ…åˆä¸å¤±æ–‡äººé›…è‡´çš„ç”»ï¼ŒçŒäººå¿«å»æ±Ÿå—å¸®æœ¬å®«å¯»æ¥ï¼", item: "å”å¯…ã€ŠæèŠ±å›¾ã€‹", desc: "å¸‚æ°‘æ–‡è‰ºå…´èµ·ï¼Œæ–‡äººç”»æ›´å¼ºè°ƒä¸ªäººçš„ä¸–ä¿—æƒ…æ„Ÿã€‚", npcReply: "æ¯çš‡å¾ˆå¼€å¿ƒï¼Œèµï¼ä»¥åæœ¬å®«ç½©ä½ ï¼â­â­â­â­â­", reward: 2000 },
        { chap: "æ˜æ¸…æ–‡è‰º", type: "è§£ç­”", title: "ä»€ä¹ˆæ˜¯â€˜åº­é™¢æ·±æ·±â€™çš„ç¾å­¦ï¼Ÿ", npc: "å»ºç­‘ç³»å­¦ç”ŸGG", story: "åœ¨åšæ±Ÿå—å›­æ—çš„è¯¾é¢˜ï¼Œå®åœ¨æä¸æ‡‚å¦‚ä½•åœ¨é‚£ä¹ˆå°çš„ç©ºé—´é‡Œé€ å‡ºé‚£ç§â€˜èµ°ä¸åˆ°å¤´â€™çš„é”™è§‰ï¼Œä¹¦é‡Œæ˜¯æ€ä¹ˆæ€»ç»“è¿™ç§ç¾å­¦çš„ï¼Ÿ", item: "æ±Ÿå—å¤å…¸å›­æ—", desc: "é€šè¿‡å€Ÿæ™¯æ¡†æ™¯ï¼Œåœ¨æœ‰é™ç©ºé—´åˆ›é€ å‡ºæ— é™çš„æ—¶ç©ºæ„Ÿã€‚", npcReply: "è¿™å°±æ˜¯ä¸­å›½äººçš„ç©ºé—´é­”æ³•ï¼â­â­â­â­â­", reward: 1200, titleUnlock: "åº­é™¢æ·±æ·±æ·±å‡ è®¸-å›­æ—è‰ºæœ¯çš„äº«å—è€…" },
        { chap: "æ˜æ¸…æ–‡è‰º", type: "å¯»äºº", title: "å¯»æ‰¾å¤§è§‚å›­é‡Œçš„ç—´æƒ…ç§", npc: "è¨€æƒ…å°è¯´å®¶G", story: "æˆ‘åœ¨æ„æ€ä¸€éƒ¨å°å»ºæœ«ä¸–çš„æ‚²å‰§å°è¯´ï¼Œéœ€è¦ä¸€ä¸ªå›é€†ã€å¤šæƒ…ã€æœ€ç»ˆæ‚Ÿé“å‡ºå®¶çš„è´µæ—å…¬å­å½¢è±¡åšå‚è€ƒï¼ŒçŒäººæœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ", item: "ã€Šçº¢æ¥¼æ¢¦ã€‹è´¾å®ç‰", desc: "å°å»ºç¤¾ä¼šæœ«æœŸçš„å›é€†è€…ï¼Œå……æ»¡å¯¹ç”Ÿå‘½æ— å¸¸çš„æ‚²å‰§æ„Ÿã€‚", npcReply: "å­—å­—çœ‹æ¥çš†æ˜¯è¡€ï¼Œåå¹´è¾›è‹¦ä¸å¯»å¸¸ã€‚â­â­â­â­â­", reward: 1500 }
    ];

    const chaptersData = [
        { name: "ä¸€ã€è¿œå¤å›¾è…¾", desc: "åŸå§‹ç‹‚é‡çš„ç”Ÿå‘½åŠ›ä¸å·«æœ¯çš„æ»¥è§ã€‚" },
        { name: "äºŒã€é’é“œé¥•é¤®", desc: "ç‹å‰çš„ç¾ï¼Œææƒ§ä¸æƒå¨çš„æ—¶ä»£ã€‚" },
        { name: "ä¸‰ã€å…ˆç§¦ç†æ€§", desc: "ç¤¼ä¹å–ä»£é¬¼ç¥ï¼Œå„’é“äº’è¡¥çš„å¥ åŸºã€‚" },
        { name: "å››ã€æ¥šè¾æ±‰èµ‹", desc: "å—æ–¹çš„æµªæ¼«ç¥è¯ä¸å¤§æ±‰çš„ç£…ç¤´ã€‚" },
        { name: "äº”ã€é­æ™‹é£åº¦", desc: "äººçš„è§‰é†’ï¼Œç§€éª¨æ¸…åƒä¸è¶…ç„¶ç‰©å¤–ã€‚" },
        { name: "å…­ã€ä½›é™€ä¸–å®¹", desc: "ä»æ‚²è‹¦ç˜¦éª¨åˆ°é›å®¹åè´µçš„ä¸–ä¿—åŒ–ã€‚" },
        { name: "ä¸ƒã€ç››å”ä¹‹éŸ³", desc: "é’æ˜¥ã€è‡ªç”±ã€è±ªè¿ˆçš„ç»å¯¹è‡ªä¿¡ã€‚" },
        { name: "å…«ã€ä¸­å”éŸµå‘³", desc: "ç¹åè¤ªå»åçš„ç»†è…»ã€å­¤ç‹¬ä¸ä¸–ä¿—ã€‚" },
        { name: "ä¹ã€å®‹å…ƒå±±æ°´", desc: "ä»æ— æˆ‘ä¹‹å¢ƒçš„æ•¬ç•ï¼Œåˆ°æŠ’æƒ…çš„ç•™ç™½ã€‚" },
        { name: "åã€æ˜æ¸…æ–‡è‰º", desc: "æµªæ¼«ä¸çºµæ¬²ï¼Œå¸‚äº•å°è¯´ä¸å›­æ—æ—¶ç©ºã€‚" }
    ];

    let state = {
        hunterName: localStorage.getItem('v7_name') || "",
        questStates: JSON.parse(localStorage.getItem('v7_qstates')) || Array(30).fill("active"),
        completedNum: parseInt(localStorage.getItem('v7_comp')) || 0,
        tokens: parseInt(localStorage.getItem('v7_tokens')) || 0,
        readTimeTotal: parseInt(localStorage.getItem('v7_time')) || 0,
        logs: JSON.parse(localStorage.getItem('v7_logs')) || [],
        chaps: JSON.parse(localStorage.getItem('v7_chaps')) || [],
        epubLoc: localStorage.getItem('v7_epubLoc') || null
    };

    let timerInterval = null, timeLeft = 0, timeTotal = 0, isRunning = false;
    let book = null, rendition = null;

    function init() {
        if(!state.hunterName) {
            document.getElementById('intro-screen').style.opacity = 1;
            setTimeout(() => { document.getElementById('intro-msg1').style.opacity = 1; }, 500);
        } else {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('profile-name').innerText = state.hunterName;
            startApp();
        }
    }

    function submitName() {
        let name = document.getElementById('intro-input').value.trim();
        if(!name) return;
        state.hunterName = name;
        localStorage.setItem('v7_name', name);
        document.getElementById('profile-name').innerText = name;
        
        document.getElementById('intro-msg1').style.opacity = 0;
        setTimeout(() => {
            document.getElementById('intro-msg1').style.display = 'none';
            let msg2 = document.getElementById('intro-msg2');
            msg2.innerHTML = `è¿™é‡Œæ˜¯å‰¯æœ¬ä¸–ç•Œã€Šç¾çš„å†ç¨‹ã€‹<br><br>æ–‡å­—çŒäºº <span style="color:var(--accent-green);font-size:1.8rem;">${name}</span><br><br>è¯·å°½æƒ…äº«å—å§~`;
            msg2.style.display = 'block';
            void msg2.offsetWidth; 
            msg2.style.opacity = 1;
            
            setTimeout(() => {
                document.getElementById('intro-screen').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('intro-screen').style.display = 'none';
                    startApp();
                }, 1500);
            }, 3000);
        }, 1500);
    }

    function startApp() {
        loadStoredEpub();
        renderQuests();
        renderChapters();
        renderMuseum();
        renderProfile();
    }

    /* === EPUB æ ¸å¿ƒé€»è¾‘ (åšå›ºå®‰å…¨ä¿®å¤ç‰ˆ V7.0) === */
    async function loadStoredEpub() {
        try {
            let storedData = await localforage.getItem('v7_epubData');
            if(storedData) {
                document.getElementById('epub-loader-area').style.display = 'none';
                
                // ç¡®ä¿æ•°æ®ä¾ç„¶æœ‰æ•ˆåæŒ‚è½½
                book = ePub(storedData);
                book.ready.then(() => {
                    return book.locations.generate(1600);
                }).then(() => {
                    updateReadingProgress();
                }).catch(e => {
                    console.warn("ç¼“å­˜è¯»å–é‡åˆ°å°é—®é¢˜ï¼Œä½†ä¸å½±å“é˜…è¯»");
                });
            }
        } catch(e) { console.error("åŠ è½½æœ¬åœ°ä¹¦å·å¤±è´¥", e); }
    }

    function loadEpub(e) {
        let file = e.target.files[0];
        if (window.FileReader && file) {
            document.getElementById('epub-status-text').innerText = "æ­£åœ¨è§£æå¹¶æŒ‚è½½å‰¯æœ¬ï¼Œè¯·ç¨å€™...";
            document.getElementById('epub-upload-btn').style.display = 'none';
            
            let reader = new FileReader();
            reader.onload = function(event) {
                let epubData = event.target.result;
                try {
                    // ç›´æ¥ç”¨ ArrayBuffer åˆå§‹åŒ–
                    book = ePub(epubData);
                    
                    book.ready.then(async () => {
                        // 1. ç¡®ä¿èƒ½æˆåŠŸç¿»å¼€ä¹¦æœ¬
                        alert("å‰¯æœ¬æ•°æ®æ³¨å…¥æˆåŠŸï¼ä½ å¯ä»¥ç‚¹å‡»ç« èŠ‚å¼€å§‹é˜…è¯»äº†ã€‚");
                        document.getElementById('epub-loader-area').style.display = 'none';
                        
                        // 2. ç¡®è®¤è§£ææ— è¯¯åï¼Œå†å­˜å…¥æœ¬åœ°æ•°æ®åº“
                        try {
                            await localforage.setItem('v7_epubData', epubData);
                        } catch(saveErr) {
                            console.warn("æ–‡ä»¶åå¤§ï¼Œæœªèƒ½å­˜å…¥æœ¬åœ°ç¼“å­˜ï¼Œä½†æœ¬æ¬¡è®¿é—®å¯æ­£å¸¸é˜…è¯»", saveErr);
                        }
                        
                        return book.locations.generate(1600);
                    }).then(() => {
                        updateReadingProgress();
                    }).catch(err => {
                        throw err; // å°†é”™è¯¯æŠ›ç»™å¤–å±‚
                    });

                } catch(err) {
                    console.error("EPUBè§£æå¤±è´¥", err);
                    alert("æ–‡ä»¶è§£æé‡åˆ°é˜»ç¢ï¼Œè¯·ç¡®ä¿æ‚¨ä¸Šä¼ çš„æ˜¯æ ‡å‡†çš„EPUBæ ¼å¼æ–‡ä»¶ã€‚");
                    document.getElementById('epub-status-text').innerText = "è§£æå¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶ã€‚";
                    document.getElementById('epub-upload-btn').style.display = 'inline-block';
                }
            };
            
            reader.onerror = function() {
                alert("è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚");
                document.getElementById('epub-upload-btn').style.display = 'inline-block';
            };
            
            reader.readAsArrayBuffer(file);
        }
    }

    function openChapter(chapIndex) {
        if(!book) {
            alert("è¯·å…ˆæ³¨å…¥EPUBæ–‡ä»¶ï¼Œå³å¯å¼€å¯é˜…è¯»æ¨¡å¼ã€‚");
            return;
        }
        
        // ç¡®ä¿å®¹å™¨å…ˆæ˜¾ç¤ºï¼Œé¿å… ePub.js æ¸²æŸ“æ—¶å°ºå¯¸å¡Œé™·ä¸º 0x0
        document.getElementById('reader-modal').style.display = "flex";
        
        setTimeout(() => {
            if(!rendition) {
                rendition = book.renderTo("viewer", { width: "100%", height: "100%", spread: "none" });
                rendition.on("relocated", function(location){
                    state.epubLoc = location.start.cfi;
                    saveData();
                    updateReadingProgress();
                });
            }
            
            if(state.epubLoc) { rendition.display(state.epubLoc); } 
            else { rendition.display(); }
        }, 100);
    }

    function closeReader() { document.getElementById('reader-modal').style.display = "none"; }
    function addBookmark() {
        if(!rendition || !state.epubLoc) return;
        alert("ä¹¦ç­¾å·²è®°å½•å½“å‰ä½ç½®ï¼ä¸‹æ¬¡æŸ¥é˜…ä¼šè‡ªåŠ¨æ¢å¤ã€‚");
    }
    function updateReadingProgress() {
        if(book && book.locations.length > 0 && state.epubLoc) {
            let percentage = book.locations.percentageFromCfi(state.epubLoc);
            let pctString = Math.round(percentage * 100) + "%";
            document.getElementById('reading-pct').innerText = pctString;
            document.getElementById('stat-progress').innerText = pctString;
        }
    }

    /* === å€’è®¡æ—¶ === */
    function toggleTimer() {
        const btn = document.getElementById('btn-start');
        if(!isRunning) {
            if(timeLeft <= 0) { timeLeft = 300; timeTotal = 300; }
            isRunning = true;
            btn.innerText = "æš‚åœé˜…è¯»";
            btn.style.background = "transparent"; btn.style.color = "var(--accent-green)";
            timerInterval = setInterval(() => {
                if(timeLeft > 0) { timeLeft--; state.readTimeTotal++; updateTimerUI(); } 
                else { endTimer(); }
            }, 1000);
        } else {
            isRunning = false; clearInterval(timerInterval);
            btn.innerText = "ç»§ç»­æ²‰æµ¸"; btn.style.background = "var(--accent-green)"; btn.style.color = "#fff";
        }
    }
    function addTime() {
        timeLeft += 300; timeTotal += 300; updateTimerUI();
        if(!isRunning) toggleTimer();
    }
    function endTimer() {
        isRunning = false; clearInterval(timerInterval);
        document.getElementById('btn-start').innerText = "å¼€å§‹æ²‰æµ¸";
        document.getElementById('btn-start').style.background = "var(--accent-green)"; document.getElementById('btn-start').style.color = "#fff";
        saveData(); renderProfile();
        const tape = document.getElementById('finishTape');
        tape.classList.add('show');
        setTimeout(() => { tape.classList.remove('show'); timeLeft = 0; timeTotal = 0; updateTimerUI(); }, 1500);
    }
    function updateTimerUI() {
        let m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        let s = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById('global-timer').innerText = `${m}:${s}`;
        let pct = timeTotal > 0 ? (timeLeft / timeTotal) * 100 : 0;
        document.getElementById('timer-progress').style.width = pct + '%';
    }

    /* === çŒåœºï¼šåŠ¨æ€è¡¥ä½æœºåˆ¶ === */
    function renderQuests() {
        const board = document.getElementById('quest-board');
        board.innerHTML = "";
        
        let activeHTML = '';
        let abandonedHTML = '';
        let activeCount = 0;

        for(let i=0; i<30; i++) {
            if(state.questStates[i] === "completed") continue;
            let q = db[i];
            
            if(state.questStates[i] === "active") {
                if(activeCount < 3) {
                    activeHTML += createQuestCard(i, q, false);
                    activeCount++;
                }
            } else if (state.questStates[i] === "abandoned") {
                abandonedHTML += createQuestCard(i, q, true);
            }
        }
        
        if(activeHTML === '' && abandonedHTML === '') {
            board.innerHTML = "<p style='text-align:center; padding: 40px; color: var(--text-light);'>âœ¦ æ‚¬èµå·²è¢«ä½ æ‰«è¡ä¸€ç©ºã€‚<br>ä½ æ˜¯ä¼ å¥‡æ–‡å­—çŒäººã€‚</p>";
        } else {
            board.innerHTML = activeHTML + abandonedHTML;
        }
    }

    function createQuestCard(i, q, isAb) {
        return `
        <div class="quest-card ${isAb ? 'abandoned' : ''}" id="quest-card-${i}">
            <div style="font-size: 0.75rem; color: #a38c77; margin-bottom: 8px;">[ ${q.type} ] Â· ${q.chap}</div>
            <div class="quest-title">${q.title}</div>
            <div class="npc-story">â€œ${q.story}â€</div>
            <div class="quest-meta">
                <span>èµé‡‘ï¼š${q.reward} Token</span>
                <span>å§”æ‰˜äººï¼š${q.npc}</span>
            </div>
            
            <div style="display:${isAb?'none':'flex'}; gap:10px;" id="btn-group-${i}">
                <button class="btn btn-solid" onclick="expandQuest(${i})">æ‰¿æ¥</button>
                <button class="btn" style="border-color:#ccc; color:#888;" onclick="abandonQuest(${i})">æ”¾å¼ƒ</button>
            </div>
            
            <div style="display:${isAb?'flex':'none'}; justify-content:center;" id="btn-recover-${i}">
                <button class="btn" onclick="recoverQuest(${i})">æ¢å¤ä»»åŠ¡</button>
            </div>
            
            <div class="quest-action-area" id="action-area-${i}">
                <textarea placeholder="åœ¨è¿™é‡Œå†™ä¸‹çº¿ç´¢..."></textarea>
                <input type="file" accept="image/*">
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-solid" onclick="submitQuest(${i})">æäº¤å§”æ‰˜</button>
                    <button class="btn" style="border-color:#ccc; color:#888;" onclick="collapseQuest(${i})">æ”¶èµ·</button>
                </div>
            </div>
        </div>
        `;
    }

    function expandQuest(idx) { document.getElementById(`btn-group-${idx}`).style.display='none'; document.getElementById(`action-area-${idx}`).style.display='block'; }
    function collapseQuest(idx) { document.getElementById(`action-area-${idx}`).style.display='none'; document.getElementById(`btn-group-${idx}`).style.display='flex'; }
    
    function abandonQuest(idx) {
        state.questStates[idx] = "abandoned";
        saveData(); renderQuests();
    }
    function recoverQuest(idx) {
        state.questStates[idx] = "active";
        saveData(); renderQuests();
    }

    function submitQuest(idx) {
        let q = db[idx];
        state.questStates[idx] = "completed";
        state.completedNum++;
        state.tokens += q.reward;
        
        let logText = `<div class="review-box"><span style="color:var(--accent-green); font-weight:bold;">[${q.chap}]</span> ${q.title}<br><div style="margin: 5px 0; color: #555;">ğŸ’¬ <b>${q.npc}:</b> "${q.npcReply}"</div><div style="font-size:0.75rem; color:gray;">å…¥è´¦ï¼š+${q.reward} Token</div></div>`;
        state.logs.unshift(logText);
        
        saveData(); renderQuests(); renderMuseum(); renderProfile();
    }

    /* === é˜…è¯»ä¸æ­£å¸¸çƒŸèŠ±ç‰¹æ•ˆ === */
    function renderChapters() {
        const list = document.getElementById('chapter-list');
        list.innerHTML = "";
        chaptersData.forEach((chap, idx) => {
            let isCap = state.chaps.includes(idx);
            list.innerHTML += `
                <div class="chapter-item ${isCap ? 'captured' : ''}">
                    <div class="chapter-title">
                        <span>${chap.name}</span>
                        <div>
                            <button class="btn" style="padding: 4px 10px; font-size: 0.75rem; margin-right:10px;" onclick="openChapter(${idx})">ğŸ“– æŸ¥é˜…</button>
                            <button class="btn btn-solid" style="padding: 4px 10px; font-size: 0.75rem; ${isCap?'background:#ccc; border:none;':''}" onclick="toggleChapter(${idx}, event)">${isCap?'å·²å®Œæˆ':'å®Œæˆ'}</button>
                        </div>
                    </div>
                    <div class="chapter-desc">${chap.desc}</div>
                </div>
            `;
        });
        document.getElementById('completion-badge').style.display = (state.chaps.length === 10) ? 'block' : 'none';
    }

    function toggleChapter(idx, event) {
        let capIndex = state.chaps.indexOf(idx);
        if (capIndex > -1) { 
            state.chaps.splice(capIndex, 1); 
        } else {
            state.chaps.push(idx);
            launchNormalFireworks(event);
            if(state.chaps.length === 10) {
                setTimeout(() => {
                    for(let i=0; i<5; i++) {
                        setTimeout(() => launchNormalFireworks(), i * 300);
                    }
                }, 500);
            }
        }
        saveData(); renderChapters(); renderProfile();
    }

    // æ­£å¸¸çš„çˆ†ç‚¸çƒŸèŠ±ç‰¹æ•ˆ
    function launchNormalFireworks(e) {
        const container = document.getElementById('fireworks-container');
        const colors = ['#bda069', '#5c7a6e', '#8c4356', '#eccc68', '#ff7f50'];
        
        // å¦‚æœæœ‰ç‚¹å‡»äº‹ä»¶ï¼Œä»¥ç‚¹å‡»ä½ç½®ä¸ºä¸­å¿ƒï¼›å¦åˆ™åœ¨å±å¹•ä¸­å¤®åä¸Š
        let startX = e ? e.clientX : window.innerWidth / 2;
        let startY = e ? e.clientY : window.innerHeight * 0.3;

        for(let i=0; i<40; i++) {
            let p = document.createElement('div');
            p.className = 'fw-particle';
            p.style.background = colors[Math.floor(Math.random() * colors.length)];
            p.style.left = startX + 'px';
            p.style.top = startY + 'px';
            p.style.width = '6px';
            p.style.height = '6px';
            
            container.appendChild(p);
            
            // å››æ•£çˆ†ç‚¸çš„ç®—æ³•
            let angle = Math.random() * Math.PI * 2;
            let velocity = 50 + Math.random() * 150;
            let tx = Math.cos(angle) * velocity;
            let ty = Math.sin(angle) * velocity;
            
            p.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
            ], { duration: 800 + Math.random() * 400, easing: 'ease-out' }).onfinish = () => p.remove();
        }
    }

    /* === å±•é¦† === */
    function renderMuseum() {
        const timeline = document.getElementById('museum-timeline');
        timeline.innerHTML = "";
        db.forEach((item, i) => {
            let isUnlocked = state.questStates[i] === "completed";
            timeline.innerHTML += `
                <div class="timeline-item ${isUnlocked ? 'unlocked' : ''}">
                    <div class="artifact-node"></div>
                    <div class="artifact-content">
                        ${isUnlocked ? `<div class="art-name">${item.item}</div><div class="art-desc">${item.desc}</div>` : `<div class="art-name" style="color:#555;">æœªçŸ¥é¦†è—</div><div style="font-size:0.75rem; color:#444; font-style:italic;">æ²‰ç¡åœ¨æ˜Ÿäº‘ä¸­...</div>`}
                    </div>
                </div>
            `;
        });
    }

    /* === æ¡£æ¡ˆ === */
    function renderProfile() {
        document.getElementById('stat-time').innerText = Math.floor(state.readTimeTotal / 60);
        document.getElementById('stat-quests').innerText = state.completedNum;
        document.getElementById('stat-tokens').innerText = state.tokens;
        
        let lvText = "è§ä¹ çŒæ‰‹";
        if(state.completedNum >= 5) lvText = "åˆé˜¶æ–‡å­—çŒäºº";
        if(state.completedNum >= 15) lvText = "é«˜é˜¶é‰´èµå®¶";
        if(state.completedNum >= 25) lvText = "ç¾å­¦å¤§å®—å¸ˆ";
        document.getElementById('hunter-level').innerText = lvText;
        
        let titleHTML = `<span class="title-badge">è§ä¹ çŒæ‰‹</span>`;
        for(let i=0; i<30; i++) {
            if(state.questStates[i] === "completed" && db[i].titleUnlock) {
                titleHTML += `<span class="title-badge">${db[i].titleUnlock}</span>`;
            }
        }
        document.getElementById('title-tags').innerHTML = titleHTML;
        document.getElementById('review-log').innerHTML = state.logs.length ? state.logs.join('') : "<p style='text-align:center; padding:20px 0; color:var(--text-light);'>ç©ºç©ºå¦‚ä¹Ÿï¼Œé™å¾…è½ç¬”ã€‚</p>";
    }

    function switchTab(tabId, el) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active-tab'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(`tab-${tabId}`).classList.add('active-tab');
        el.classList.add('active');
        window.scrollTo(0, 0);
    }

    function saveData() {
        localStorage.setItem('v7_qstates', JSON.stringify(state.questStates));
        localStorage.setItem('v7_comp', state.completedNum);
        localStorage.setItem('v7_tokens', state.tokens);
        localStorage.setItem('v7_time', state.readTimeTotal);
        localStorage.setItem('v7_logs', JSON.stringify(state.logs));
        localStorage.setItem('v7_chaps', JSON.stringify(state.chaps));
        if(state.epubLoc) localStorage.setItem('v7_epubLoc', state.epubLoc);
    }

    window.onload = init;
</script>
</body>
</html>